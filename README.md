<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="200" alt="Nest Logo" /></a>
</p>

# تکنولوژی های مورد استفاده 
* Docker 
* Redis 
* TCP 
* RabbitMQ
* Mongo
* Mongoose 


# معماری 
معماری این پروژه مایکروسرویس است که از سه سرویس ``Authentication`` و  ``Books`` و ``Cart`` تشکیل شده است   
## Authentication Service 
این سرویس مربوط به مدیریت کاربران است . با استفاده از این سرویس کاربران میتوانند مراحل ``Register``  و ``Login`` را انجام دهند و با استفاده از توکنی که دریافت میکنند احراز هویت خود را برای دسترسی های سایت انجام دهند           
هر کاربر میتواند در سایت اشتراک ``Premium`` داشته باشد که میتواند فهرست کتاب هایی که اشتراک ``Premium`` لازم دارد را مشاهده کند
## Books Service 
``این سرویس برای مدیریت کتاب های مجموعه است  ``         
   با استفاده از این سرویس میتوانیم ژانر های مختلف مربوط به کتاب را تعریف کنیم و برای تعریف کتاب از آیدی  ژانر ها استفاده کنیم تا بتوانیم اطلاعات مربوطه به ژانر را دریافت کنیم    
هر کتاب شامل 
``نام کتاب``
 , 
 ``نام نویسنده ``
 ,
 ``اطلاعات ژانر مربوطه ``
 ,
`` تاریخ نشر``
,
``توضیحات`` 
است      
میتوانیم هر کتاب را با خصوصیات بالا تعریف کنیم و علاوه بر فیلد های بالا میتوانیم از فیلد ``isPremium`` استفاده کنیم . زمانی که مقدار این فیلد برابر با ``true`` باشد به این معناست که کتاب را فقط کسانی دسترسی دارند که در سایت اشتراک premium دارند
## Cart Service 
این سرویس مربوط به سبد خرید مجموعه است که کاربر میتوانند کتاب های موجود را به سبد خرید خود اضافه کند . روند کار سبد خرید به این صورت است که هر کاربر میتواند چندین سبد خرید داشته باشد ولی فقط میتواند یک سبد خرید باز داشته باشد و تشخیص اینکه سبد خرید هنوز باز است یا خیر از طریق فیلد ``isPaid`` انجام میشود        
زمانی که کاربر سبد خرید خود را پرداخت کند سبد خرید به پرداخت تغییر پیدا میکند و برای سفارش جدید باید سبد خرید جدیدی باز کند          

##  الگوریتم سبد خرید
الگوریتم سبد خرید به این صورت است که کاربر باید فقط یک سبد خرید باز داشته باشد ولی میتوانند چندین سبد خرید داشته باشد . زمانی که کاربر محصولی را به سبد خرید اضافه میکند چک میشود که اگر این سبد خرید باز داشت و این محصول در سبد خرید نبود آن را اضافه میکند و اگر سبد خرید بازی وجود نداشت سبد خرید جدیدی باز میکند و کاربر میتواند محصولات موجود در سبد خرید را مشاهده کند و آن را از سبد خرید خود حذف کند 
## الگوریتم محبوب ترین کتاب ها
الگوریتم محبوب ترین کتاب ها به این صورت کار میکند که زمانی که کتابی را به سبد خرید اضافه میکنیم فیلد ``salesAmount`` یک عدد اضافه میشود به این منظور که این محصول خریداری شده است و زمانی که محصولی را از سبد خرید کم میکنیم یک عدد از ``salesAmount`` کم میکنیم 
برای تشخیص کتاب های محبوب ده کتابی را که بیشترین مقدار ``salesAmount`` را دارند را پیدا کرده و در ``Redis`` ذخیره میکنیم 
برای تشخیص کتاب های محبوب ده کتابی را که بیشترین مقدار ``salesAmount`` را دارند را پیدا کرده و در ``Redis`` ذخیره میکنیم            
زمانی که یک کتاب حذف میشود و یا مقدار ``salesAmount``  عوض میشود مجددا ``query`` به دیتابیس زده میشود و ``redis`` را پر میکنیم
## چالش های پروژه 
 اولین چالشی که در این پروژه داشتیم استفاده از ``pnpm`` در مایکروسرویس ها بود که به version های پکیج ``@nestjs/common`` , ``@nestjs/core`` , ``@nestjs/microservices``  حساس بود که باید در یک  ``version`` باشند          
 چالش های مربوط به ``RMQ``
 ##  بهبود ویژگی
  اگر زمان بیشتری برای توسعه داشتم قسمت ``Redis`` مربوط به محبوب ترین کتاب ها را بهبود میبخشیدم که لازم نباشد بعد از حذف کتاب یا کم و یا زیاد شدن مقدار ``SalesAmount`` لازم نباشد که query به دیتابیس داشته باشیم و تا جایی که امکان داشت در سطح کد این کار را انجام میدادم و سعی میکردم کمترین ``query`` به دیتابیس را داشته باشیم        
  مورد بعدی که اگر زمان بیشتری داشتم پیاده سازی میکردم قسمت ``Api Gateway`` است